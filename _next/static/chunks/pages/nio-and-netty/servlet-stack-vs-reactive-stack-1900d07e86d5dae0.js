(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{9760:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/nio-and-netty/servlet-stack-vs-reactive-stack",function(){return n(3765)}])},3765:function(e,r,n){"use strict";n.r(r),n.d(r,{__toc:function(){return d},default:function(){return x}});var s=n(5893),t=n(2673),i=n(373),a=n(8426);n(9128);var o=n(2643),l={src:"/docs-spring-webflux/_next/static/media/servlet-stack.c149e42a.png",height:712,width:1267,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAIAAAA8r+mnAAAATklEQVR42h3KwQ2AMAxDUSepVJVD9wGJqRGsRg8lJs072l+e+xrj3Y+z9w6g1qqqJEtrm5XFzESE5JwzvqIqIAG4O5Il/dwJBqRoYwXwA/QsHEtaV4o9AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:4},c={src:"/docs-spring-webflux/_next/static/media/servlet-container.a21bd289.png",height:854,width:1564,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAIAAAA8r+mnAAAAbUlEQVR42h2MOw5AMABAe1eMwoLrcAVUxAE6+Gwd/KamSDeaNE2lSuOtL+8BY8z7wznftl0pJYSQUgIrIIRFkc/LWlY1YyzLUowx0PpJ4shznXGaq7ohhISBjxACdmLb+1b7cbTdcJ5X33eU0g8YfVBgrVgXrAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:4};let d=[{depth:2,value:"Servlet Stack vs Reactive Stack",id:"servlet-stack-vs-reactive-stack"},{depth:2,value:"Servlet Stack",id:"servlet-stack"},{depth:3,value:"Servlet Container",id:"servlet-container"},{depth:3,value:"Spring Security",id:"spring-security"},{depth:3,value:"Spring Data",id:"spring-data"},{depth:2,value:"C10K (Client 10K)",id:"c10k-client-10k"},{depth:2,value:"10K 의 스레드 실행시 생길수 있는 문제들",id:"10k-의-스레드-실행시-생길수-있는-문제들"},{depth:2,value:"가능한 해결책 : epoll(), kqueue, select()",id:"가능한-해결책--epoll-kqueue-select"}];function _createMdxContent(e){let r=Object.assign({h2:"h2",p:"p",img:"img",ul:"ul",li:"li",h3:"h3",code:"code",pre:"pre",span:"span",a:"a",blockquote:"blockquote"},(0,o.a)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"servlet-stack-vs-reactive-stack",children:"Servlet Stack vs Reactive Stack"}),"\n",(0,s.jsx)(r.h2,{id:"servlet-stack",children:"Servlet Stack"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{placeholder:"blur",src:l})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsxs)(r.p,{children:["Servlet Stack 은 대표적으로 위와 같이 구성되어 있습니다. 스레드를 무분별하게 사용하는 것으로 문제되는 부분은 Servlet Container, Spring Security, Spring Data 스택입니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Servlet Container"}),"\n",(0,s.jsx)(r.li,{children:"Spring Security"}),"\n",(0,s.jsx)(r.li,{children:"Spring Data"}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(r.h3,{id:"servlet-container",children:"Servlet Container"}),"\n",(0,s.jsxs)(r.p,{children:["Servlet Container 를 지원하는 대표적인 컨테이너는 Tomcat, Jetty, JBoss 가 있습니다. Servet Container 는 ",(0,s.jsx)(r.code,{children:"request-per-thread"})," 모델을 사용하는데, 요청이 들어올 때마다 스레드를 할당하는 방식으로 클라이언트의 요청 처리에 동시성을 부여합니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{placeholder:"blur",src:c})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsxs)(r.p,{children:["Connector 가 제일 앞단에서 HTTP 통신을 수행하고 Filter 가 Servlet 의 앞단에서 각 요청의 앞/뒤에서 미리 등록해둔 동작을 수행합니다. 그리고 request, response 는 Servlet 의 service() 에 전달 됩니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsxs)(r.p,{children:["이 Connector 는 request 하나에 대해 하나의 thread 를 사용하며, tomcat 의 기본 설정 스레드 풀 사이즈는 200 개입니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsxs)(r.p,{children:["전통적인 웹 서비스에서는 이런 모델이 어느 정도는 통했습니다. 하지만 최근의 트래픽 처리 모델에서는 IO 가 많고, 여러가지 http 요청 등을 수행하고 Security Context 관리, MVC 동작 수행등을 하면서 조금씩 요청 하나에 드는 비용이 커지기 시작했습니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsxs)(r.p,{children:["따라서 하나의 스레드가 회수 되는 데에 예전보다 더 긴 시간이 소요되게 되었고, 스레드를 지나치게 낭비한다는 측면에서 단점이 있습니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(r.h3,{id:"spring-security",children:"Spring Security"}),"\n",(0,s.jsxs)(r.p,{children:["Spring Security 는 인증 (Authentication), 인가(Authorization) 를 위한 유용한 기능들을 많이 제공합니다. 하지만 Servlet Stack 기반의 Spring Security 역시 Thread 모델로 인한 단점들이 존재합니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsx)(r.p,{children:"예를 들어 Spring Security 를 사용하다보면,  SecurityContextHolder 를 이용해서 authentication 을 set 하게 됩니다."}),"\n",(0,s.jsx)(r.pre,{"data-language":"java","data-theme":"default",children:(0,s.jsxs)(r.code,{"data-language":"java","data-theme":"default",children:[(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"package"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"org"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"springframework"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"security"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"core"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"context"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,s.jsx)(r.span,{className:"line",children:" "}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"class"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"SecurityContextHolder"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,s.jsx)(r.span,{className:"line",children:" "}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"private"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"static"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"void"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"initializeStrategy"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"MODE_PRE_INITIALIZED"'}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"equals"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"(strategyName)) {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"Assert"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"state"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"(strategy "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"null"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"When using MODE_PRE_INITIALIZED, setContextHolderStrategy must be called with the fully constructed strategy"'}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"    } "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"!"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"StringUtils"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"hasText"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"(strategyName)) {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"        strategyName "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"MODE_THREADLOCAL"'}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      }"})}),"\n",(0,s.jsx)(r.span,{className:"line",children:" "}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"strategyName"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"equals"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"MODE_THREADLOCAL"'}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:")) {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"        strategy "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"ThreadLocalSecurityContextHolderStrategy()"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      } "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"strategyName"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"equals"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"MODE_INHERITABLETHREADLOCAL"'}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:")) {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"        strategy "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"InheritableThreadLocalSecurityContextHolderStrategy()"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      } "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"strategyName"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"equals"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"MODE_GLOBAL"'}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:")) {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"        strategy "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"GlobalSecurityContextHolderStrategy()"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      } "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"try"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"Class"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"> clazz "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"Class"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"forName"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"(strategyName);"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"Constructor"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"> customStrategy "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"clazz"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"getConstructor"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"          strategy "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" (SecurityContextHolderStrategy)"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"customStrategy"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"newInstance"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"        } "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"catch"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-keyword)"},children:"Exception"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:" var2) {"})]}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-constant)"},children:"ReflectionUtils"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-function)"},children:"handleReflectionException"}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"(var2);"})]}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,s.jsx)(r.span,{className:"line",children:" "}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"      }"})}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"  "})}),"\n",(0,s.jsxs)(r.span,{className:"line",children:[(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,s.jsx)(r.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,s.jsx)(r.span,{className:"line",children:" "}),"\n",(0,s.jsx)(r.span,{className:"line",children:(0,s.jsx)(r.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,s.jsxs)(r.p,{children:["SecurityContextHolder 가 사용하는 기본 공유 전략은 ",(0,s.jsx)(r.code,{children:"MODE_THREADLOCAL"})," 입니다. 위 코드를 보면 ThreadLocal 을 사용하기에 reactive 환경 처럼 스레드가 계속 바뀌는 환경에서는 Spring Security 를 사용하기에는 쉽지 않습니다. SecurityContextHolder 의 공유 전략에 대해서는 아래의 자료들을 참고해주시기 바랍니다."]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://yoon0120.tistory.com/48",children:"SpringContext 공유 전략"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://ohtaeg.tistory.com/8",children:"SecurityContextHolder 의 내부를 파헤쳐보자"})}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(r.h3,{id:"spring-data",children:"Spring Data"}),"\n",(0,s.jsxs)(r.p,{children:["Spring Data 의 연산은 블로킹 방식의 동기연산을 수행합니다. 그리고 DB 요청 하나당 하나의 스레드를 사용합니다. 하나의 스레드가 블로킹 기반의 동기연산을 수행하는데, DB 연산의 비용(시간)이 꽤 높은 편에 속하기에 스레드를 어느 정도는 비싼 값을 치뤄서 사용합니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(r.h2,{id:"c10k-client-10k",children:"C10K (Client 10K)"}),"\n",(0,s.jsxs)(r.p,{children:["1만개의 클라이언트가 요청을 하는 상황에 대한 문제를 의미하는 ",(0,s.jsx)(r.a,{href:"http://www.kegel.com/c10k.html",children:"C10K Problem"}),"은 굉장히 잘 알려진 고전적인 주제입니다. ",(0,s.jsx)(r.a,{href:"http://www.kegel.com/c10k.html",children:"C10K Problem"})," 은 1999년 Dan Kegel 이라는 개발자가 제기한 문제입니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsx)(r.p,{children:"이것과 관련해서 읽어볼만한 자료들은 아래와 같습니다."}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"http://www.kegel.com/c10k.html",children:"C10K Problem"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://oliveyoung.tech/blog/2023-10-02/c10-problem/",children:"고전 돌아보기, C10K 문제 (C10K Problem)"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://manhyuk.github.io/c10k-problem/",children:"about C10K problem"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://niklasjang.tistory.com/56",children:"쉽게 정리한 네트워크 | Apache와 Nginx의 요청 응답 구조"})}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(r.p,{children:"1초에 10000개의 클라이언트의 요청이 오는 것을 처리하려 할 때 흔히 처음에는 아래와 같은 생각을 할수도 있습니다."}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"thread 를 이용해서 스레드를 request 마다 1개씩 할당한다."}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsxs)(r.p,{children:["흔히 이 문제를 설명할 때 Apache 와 Nginx 의 차이점을 들어서 설명합니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsxs)(r.p,{children:["참고 : ",(0,s.jsx)(r.a,{href:"https://niklasjang.tistory.com/56",children:"쉽게 정리한 네트워크 | Apache와 Nginx의 요청 응답 구조"})]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Apache 는 멀티 프로세스 + 멀티 스레드 방식을 사용합니다. 사용자의 요청에 대해 Process/Thread 를 생성하는 방식으로 대응합니다. 항상 여유로운 프로세스/스레드를 생성합니다. 미리 설정해둔 유휴(Idle) 프로세스의 수에 따라 넘어가면 kill 하고, 유휴 스레드가 적으면 kill 을 하는 방식으로 스레드를 관리합니다. Apache 는 일반적으로 요청 하나에 스레드 하나가 대응되도록 구성되어 있습니다. 하나의 프로세스가 관리할 수 있는 스레드의 수는 한정되어 있는데, 따라서 사용자의 접속이 증가하면 프로세스를 새로 fork 합니다. Apache 는 fork 를 할 때마다 CPU와 메모리 사용량이 증가한다는 단점이 있습니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsx)(r.p,{children:"Nginx 는 멀티 프로세스 + 싱글 스레드 방식을 사용합니다. low memory usage, high concurrency 를 지원하기 위해 async event driven 방식을 채택하고 있고 싱글스레드에서 요청에 응답을 합니다. Nginx 는 master process 가 다수의 worker process 를 관리합니다. master process 는 worker process 를 관리하는 일만을 담당하고 worker process 에서 사용자의 응답에 대응합니다. 각각의 worker 는 초당 수천개의 동시접속, 요청을 처리 가능합니다."}),"\n",(0,s.jsx)(r.p,{children:"Apache, Nginx 의 동시 접속자가 늘어날 때 RPS (Request Per Second) 의 변화 추이는 아래 그림과 같습니다. RPS 는 1초에 처리 가능한 Request 의 개수라고 이해하시면 됩니다. 대표적인 웹 서버인 Apache 와 Nginx 에서의 RPS 처리 성능을 비교한 그래프를 보면 Apache Httpd 의 경우 성능이 급속도로 떨어지는 것을 확인 가능합니다."}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"https://oliveyoung.tech/static/5eb69bdc1ab5c5c7e8099a6e00bbaf3f/04948/apache-nginx.png",alt:""})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(r.h2,{id:"10k-의-스레드-실행시-생길수-있는-문제들",children:"10K 의 스레드 실행시 생길수 있는 문제들"}),"\n",(0,s.jsxs)(r.p,{children:["첫번째로 메모리 문제가 발생합니다. thread 각각은 메모리 스택을 가집니다. PCB 보다는 작지만 64Bit JVM 의 경우 1개의 스레드에 대해 1024KByte(1MB)를 사용한다고 합니다. 1만명일 경우 10000MB = 10GB 가 필요하다는 계산에 이르게 됩니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsxs)(r.p,{children:["두번째로 스레드가 많을 경우 Context Switching 시에 경합(Racing Condition)이 발생합니다. 각각의 Thread 가 사용할 CPU 시간을 할당받기 위해 서로 경쟁을 하게 됩니다. 소켓 프로그래밍의 각 커넥션을 10K 의 스레드로 동작할 경우 10K 스레드 각각이 accept(), listen() 동작 등으로 인한 polling 을 하기 위한 경쟁이 발생합니다. 즉 Busy Wait 증상이 나타나기 시작합니다. 채팅창에 텍스트를 입력하지 않더라도 accept(), listen() 을 위한 무한 polling 을 10K의 스레드에서 수행중이기에 10K의 스레드 각각이 서로 CPU 자원을 차지하기 위해 싸우게 됩니다.",(0,s.jsx)("br",{})]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.a,{href:"https://www.baeldung.com/cs/servers-threads-number",children:"How Many Threads Is Too Many?"})," 에서는 아래의 그림으로 위 현상으로 인한 결과를 이야기합니다."]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"https://www.baeldung.com/wp-content/uploads/sites/4/2022/08/OptimumNumberOfThreads.png",alt:""})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(r.h2,{id:"가능한-해결책--epoll-kqueue-select",children:"가능한 해결책 : epoll(), kqueue, select()"})]})}let h={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}=Object.assign({},(0,o.a)(),e.components);return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/nio-and-netty/servlet-stack-vs-reactive-stack.mdx",route:"/nio-and-netty/servlet-stack-vs-reactive-stack",timestamp:1710133134e3,pageMap:[{kind:"Folder",name:"concurrent-programming-basic",route:"/concurrent-programming-basic",children:[{kind:"MdxPage",name:"blocking-vs-nonblocking",route:"/concurrent-programming-basic/blocking-vs-nonblocking"},{kind:"MdxPage",name:"completable-future",route:"/concurrent-programming-basic/completable-future"},{kind:"MdxPage",name:"completable-stage",route:"/concurrent-programming-basic/completable-stage"},{kind:"MdxPage",name:"intro",route:"/concurrent-programming-basic/intro"},{kind:"MdxPage",name:"sync-vs-async",route:"/concurrent-programming-basic/sync-vs-async"},{kind:"Meta",data:{intro:"Intro","sync-vs-async":"동기 vs 비동기","blocking-vs-nonblocking":"블로킹 vs 논 블로킹","completable-future":"CompletableFuture","completable-stage":"CompletableStage"}}]},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"nio-and-netty",route:"/nio-and-netty",children:[{kind:"MdxPage",name:"intro",route:"/nio-and-netty/intro"},{kind:"MdxPage",name:"java-io-java-nio-java-aio",route:"/nio-and-netty/java-io-java-nio-java-aio"},{kind:"MdxPage",name:"java-nio-socket-communication",route:"/nio-and-netty/java-nio-socket-communication"},{kind:"MdxPage",name:"servlet-stack-vs-reactive-stack",route:"/nio-and-netty/servlet-stack-vs-reactive-stack"},{kind:"MdxPage",name:"what-is-aio",route:"/nio-and-netty/what-is-aio"},{kind:"MdxPage",name:"what-is-nio",route:"/nio-and-netty/what-is-nio"},{kind:"Meta",data:{intro:"Intro","java-io-java-nio-java-aio":"Java IO,NIO,AIO","what-is-nio":"NIO 의 개념, 특징, 주요 클래스","java-nio-socket-communication":"Java NIO 소켓통신","what-is-aio":"AIO 의 개념, 특징, 예제","servlet-stack-vs-reactive-stack":"Servlet Stack vs Reactive Stack"}}]},{kind:"Folder",name:"r2dbc-mysql",route:"/r2dbc-mysql",children:[{kind:"MdxPage",name:"example",route:"/r2dbc-mysql/example"},{kind:"MdxPage",name:"intro",route:"/r2dbc-mysql/intro"},{kind:"MdxPage",name:"what-is-r2dbc",route:"/r2dbc-mysql/what-is-r2dbc"},{kind:"Meta",data:{intro:"Intro","what-is-r2dbc":"R2DBC 란?",example:"예제"}}]},{kind:"Folder",name:"reactive-mongodb",route:"/reactive-mongodb",children:[{kind:"MdxPage",name:"example",route:"/reactive-mongodb/example"},{kind:"MdxPage",name:"intro",route:"/reactive-mongodb/intro"},{kind:"Meta",data:{intro:"Intro",example:"예제"}}]},{kind:"Folder",name:"reactive-programming",route:"/reactive-programming",children:[{kind:"MdxPage",name:"intro",route:"/reactive-programming/intro"},{kind:"MdxPage",name:"java-nio-bad-point-and-solution",route:"/reactive-programming/java-nio-bad-point-and-solution"},{kind:"MdxPage",name:"netflix-rxjava-story",route:"/reactive-programming/netflix-rxjava-story"},{kind:"MdxPage",name:"proactor-pattern",route:"/reactive-programming/proactor-pattern"},{kind:"MdxPage",name:"reactive-streams-libraries",route:"/reactive-programming/reactive-streams-libraries"},{kind:"MdxPage",name:"reactive-streams",route:"/reactive-programming/reactive-streams"},{kind:"MdxPage",name:"reactor-pattern",route:"/reactive-programming/reactor-pattern"},{kind:"MdxPage",name:"what-is-epoll",route:"/reactive-programming/what-is-epoll"},{kind:"MdxPage",name:"what-is-reactive",route:"/reactive-programming/what-is-reactive"},{kind:"Meta",data:{intro:"intro","what-is-reactive":"Reactive란?","netflix-rxjava-story":"Netflix RxJava 이야기","reactive-streams":"Reactive Streams - Publisher, Subscriber 개념, 예제","reactive-streams-libraries":"Reactive Streams 라이브러리들","java-nio-bad-point-and-solution":"Java NIO 의 논블로킹 방식 동기연산의 문제점과 해결책, 멀티플렉싱","what-is-epoll":"epoll 이란?","reactor-pattern":"reactor 패턴","proactor-pattern":"proactor 패턴"}}]},{kind:"Folder",name:"server-sent-event",route:"/server-sent-event",children:[{kind:"MdxPage",name:"example",route:"/server-sent-event/example"},{kind:"MdxPage",name:"intro",route:"/server-sent-event/intro"},{kind:"MdxPage",name:"what-is-sse",route:"/server-sent-event/what-is-sse"},{kind:"Meta",data:{intro:"Intro","what-is-sse":"SSE (Server Sent Event) 의 개념",example:"예제코드"}}]},{kind:"Folder",name:"spring-cloud-stream-and-kafka",route:"/spring-cloud-stream-and-kafka",children:[{kind:"MdxPage",name:"intro",route:"/spring-cloud-stream-and-kafka/intro"},{kind:"MdxPage",name:"kafka-basic",route:"/spring-cloud-stream-and-kafka/kafka-basic"},{kind:"MdxPage",name:"kafka-docker-compose",route:"/spring-cloud-stream-and-kafka/kafka-docker-compose"},{kind:"MdxPage",name:"spring-cloud-stream-kafka-binder",route:"/spring-cloud-stream-and-kafka/spring-cloud-stream-kafka-binder"},{kind:"MdxPage",name:"spring-cloud-stream",route:"/spring-cloud-stream-and-kafka/spring-cloud-stream"},{kind:"Meta",data:{intro:"Intro","kafka-basic":"Kafka 의 주요 개념들","kafka-docker-compose":"Kafak 로컬 개발환경 (docker-compose)","spring-cloud-stream":"Spring Cloud Stream","spring-cloud-stream-kafka-binder":"Spring Cloud Stream Kafka Binder"}}]},{kind:"Folder",name:"spring-webflux",route:"/spring-webflux",children:[{kind:"MdxPage",name:"annotated-controller",route:"/spring-webflux/annotated-controller"},{kind:"MdxPage",name:"codec",route:"/spring-webflux/codec"},{kind:"MdxPage",name:"dispatcher-handler-communication-spring-webflux",route:"/spring-webflux/dispatcher-handler-communication-spring-webflux"},{kind:"MdxPage",name:"intro",route:"/spring-webflux/intro"},{kind:"MdxPage",name:"spring-mvc-vs-spring-webflux",route:"/spring-webflux/spring-mvc-vs-spring-webflux"},{kind:"Meta",data:{intro:"Intro","spring-mvc-vs-spring-webflux":"Spring MVC vs Spring Webflux","dispatcher-handler-communication-spring-webflux":"DispatcherHandler 와 Spring Webflux","annotated-controller":"Annotated Controller",codec:"Codec"}}]},{kind:"Folder",name:"webflux-websocket",route:"/webflux-websocket",children:[{kind:"MdxPage",name:"example",route:"/webflux-websocket/example"},{kind:"MdxPage",name:"intro",route:"/webflux-websocket/intro"},{kind:"Meta",data:{intro:"Intro",example:"예제"}}]},{kind:"Meta",data:{index:"Introduction","concurrent-programming-basic":"동시성 프로그래밍 개념들","nio-and-netty":"NIO, Netty","reactive-programming":"Reactive Programming","spring-webflux":"Spring Webflux","server-sent-event":"Server Sent Event (SSE)","webflux-websocket":"Webflux Websocket","r2dbc-mysql":"Spring Data R2dbc","reactive-mongodb":"Spring Data Reactive Mongodb","spring-cloud-stream-and-kafka":"Spring Cloud Stream & Kafka",contact:{title:"Contact ↗",type:"page",href:"-",newWindow:!0}}}],flexsearch:{codeblocks:!0},title:"Servlet Stack Vs Reactive Stack",headings:d},pageNextRoute:"/nio-and-netty/servlet-stack-vs-reactive-stack",nextraLayout:i.ZP,themeConfig:a.Z};var x=(0,t.j)(h)},8426:function(e,r,n){"use strict";var s=n(5893);n(7294);let t={logo:(0,s.jsx)("span",{children:"Docs Spring Webflux"}),project:{link:"https://github.com/chagchagchag/docs-spring-webflux"},docsRepositoryBase:"https://github.com/chagchagchag/docs-spring-webflux",footer:{text:"Nextra Docs Template"}};r.Z=t},5789:function(){}},function(e){e.O(0,[774,796,888,179],function(){return e(e.s=9760)}),_N_E=e.O()}]);